plugin: community.general.proxmox
url: 'https://pve.mtopps.xyz:8006'
user: ansible@pve
token_id: audit
token_secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32386135333837306334646533383230653765303966373361333838326133323335323565613637
          3036313663356330626463333866646536303730636239620a343330363866613334363364346335
          33336637383839303063613832313261336634633334633431396562353032653638636130363732
          3338373635343866300a643534306430336563653963323965376330356430653930633831386333
          30356438643263363034333333383736336636356363336463653863363233323462363230323461
          3436633036623937326564626537333664643032623363356535

want_facts: true
validate_certs: true
use_extra_vars: true
want_proxmox_nodes_ansible_host: true

keyed_groups:
  - key: proxmox_tags_parsed
    prefix: tag
    separator: '_'

groups:
  docker_hosts: "'docker' in (proxmox_tags_parsed|list)"
  ubuntu_hosts: "'ubuntu' in (proxmox_tags_parsed|list)"
  debian_hosts: "'debian' in (proxmox_tags_parsed|list)"

compose:
  ansible_host: "proxmox_ipconfig0.ip.split('/')[0] if proxmox_vmtype == 'qemu' else proxmox_net0.ip.split('/')[0]"
  # ansible_host: proxmox_agent_interfaces[1]["ip-addresses"][0] | default(proxmox_net0.ip) | ansible.utils.ipaddr("address")
  ansible_user: "'matt' if proxmox_vmtype == 'qemu' else 'root'"
